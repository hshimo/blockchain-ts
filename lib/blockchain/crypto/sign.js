"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.verifyData = exports.signData = exports.signDataWithPassphrase = exports.signDataWithPrivateKey = exports.verifyMessageWithPublicKey = exports.signMessageWithPassphrase = exports.digestMessage = void 0;

var _varuintBitcoin = require("varuint-bitcoin");

var _buffer = require("./buffer");

var _constants = require("./constants");

var _hash = require("./hash");

var _keys = require("./keys");

var _nacl = require("./nacl");

/*
 * Copyright Â© 2018 Lisk Foundation
 *
 * See the LICENSE file at the top-level directory of this distribution
 * for licensing information.
 *
 * Unless otherwise agreed in a custom licensing agreement with the Lisk Foundation,
 * no part of this software, including this file, may be copied, modified,
 * propagated, or distributed except according to the terms contained in the
 * LICENSE file.
 *
 * Removal or modification of this copyright notice is prohibited.
 *
 */
var createHeader = function createHeader(text) {
  return "-----".concat(text, "-----");
};

var signedMessageHeader = createHeader('BEGIN LISK SIGNED MESSAGE');
var messageHeader = createHeader('MESSAGE');
var publicKeyHeader = createHeader('PUBLIC KEY');
var secondPublicKeyHeader = createHeader('SECOND PUBLIC KEY');
var signatureHeader = createHeader('SIGNATURE');
var secondSignatureHeader = createHeader('SECOND SIGNATURE');
var signatureFooter = createHeader('END LISK SIGNED MESSAGE');
var SIGNED_MESSAGE_PREFIX_BYTES = Buffer.from(_constants.SIGNED_MESSAGE_PREFIX, 'utf8');
var SIGNED_MESSAGE_PREFIX_LENGTH = (0, _varuintBitcoin.encode)(_constants.SIGNED_MESSAGE_PREFIX.length);

var digestMessage = function digestMessage(message) {
  var msgBytes = Buffer.from(message, 'utf8');
  var msgLenBytes = (0, _varuintBitcoin.encode)(message.length);
  var dataBytes = Buffer.concat([SIGNED_MESSAGE_PREFIX_LENGTH, SIGNED_MESSAGE_PREFIX_BYTES, msgLenBytes, msgBytes]);
  return (0, _hash.hash)((0, _hash.hash)(dataBytes));
};

exports.digestMessage = digestMessage;

var signMessageWithPassphrase = function signMessageWithPassphrase(message, passphrase) {
  var msgBytes = digestMessage(message);

  var _getPrivateAndPublicK = (0, _keys.getPrivateAndPublicKeyBytesFromPassphrase)(passphrase),
      privateKeyBytes = _getPrivateAndPublicK.privateKeyBytes,
      publicKeyBytes = _getPrivateAndPublicK.publicKeyBytes;

  var signature = (0, _nacl.signDetached)(msgBytes, privateKeyBytes);
  return {
    message: message,
    publicKey: (0, _buffer.bufferToHex)(publicKeyBytes),
    signature: (0, _buffer.bufferToHex)(signature)
  };
};

exports.signMessageWithPassphrase = signMessageWithPassphrase;

var verifyMessageWithPublicKey = function verifyMessageWithPublicKey(_ref) {
  var message = _ref.message,
      publicKey = _ref.publicKey,
      signature = _ref.signature;
  var msgBytes = digestMessage(message);
  var signatureBytes = (0, _buffer.hexToBuffer)(signature);
  var publicKeyBytes = (0, _buffer.hexToBuffer)(publicKey);

  if (publicKeyBytes.length !== _nacl.NACL_SIGN_PUBLICKEY_LENGTH) {
    throw new Error("Invalid publicKey, expected ".concat(_nacl.NACL_SIGN_PUBLICKEY_LENGTH, "-byte publicKey"));
  }

  if (signatureBytes.length !== _nacl.NACL_SIGN_SIGNATURE_LENGTH) {
    throw new Error("Invalid signature length, expected ".concat(_nacl.NACL_SIGN_SIGNATURE_LENGTH, "-byte signature"));
  }

  return (0, _nacl.verifyDetached)(msgBytes, signatureBytes, publicKeyBytes);
};

exports.verifyMessageWithPublicKey = verifyMessageWithPublicKey;

var signDataWithPrivateKey = function signDataWithPrivateKey(data, privateKey) {
  var signature = (0, _nacl.signDetached)(data, privateKey);
  return (0, _buffer.bufferToHex)(signature);
};

exports.signDataWithPrivateKey = signDataWithPrivateKey;

var signDataWithPassphrase = function signDataWithPassphrase(data, passphrase) {
  var _getPrivateAndPublicK2 = (0, _keys.getPrivateAndPublicKeyBytesFromPassphrase)(passphrase),
      privateKeyBytes = _getPrivateAndPublicK2.privateKeyBytes;

  return signDataWithPrivateKey(data, privateKeyBytes);
};

exports.signDataWithPassphrase = signDataWithPassphrase;
var signData = signDataWithPassphrase;
exports.signData = signData;

var verifyData = function verifyData(data, signature, publicKey) {
  return (0, _nacl.verifyDetached)(data, (0, _buffer.hexToBuffer)(signature), (0, _buffer.hexToBuffer)(publicKey));
};

exports.verifyData = verifyData;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9ibG9ja2NoYWluL2NyeXB0by9zaWduLnRzIl0sIm5hbWVzIjpbImNyZWF0ZUhlYWRlciIsInRleHQiLCJzaWduZWRNZXNzYWdlSGVhZGVyIiwibWVzc2FnZUhlYWRlciIsInB1YmxpY0tleUhlYWRlciIsInNlY29uZFB1YmxpY0tleUhlYWRlciIsInNpZ25hdHVyZUhlYWRlciIsInNlY29uZFNpZ25hdHVyZUhlYWRlciIsInNpZ25hdHVyZUZvb3RlciIsIlNJR05FRF9NRVNTQUdFX1BSRUZJWF9CWVRFUyIsIkJ1ZmZlciIsImZyb20iLCJTSUdORURfTUVTU0FHRV9QUkVGSVgiLCJTSUdORURfTUVTU0FHRV9QUkVGSVhfTEVOR1RIIiwibGVuZ3RoIiwiZGlnZXN0TWVzc2FnZSIsIm1lc3NhZ2UiLCJtc2dCeXRlcyIsIm1zZ0xlbkJ5dGVzIiwiZGF0YUJ5dGVzIiwiY29uY2F0Iiwic2lnbk1lc3NhZ2VXaXRoUGFzc3BocmFzZSIsInBhc3NwaHJhc2UiLCJwcml2YXRlS2V5Qnl0ZXMiLCJwdWJsaWNLZXlCeXRlcyIsInNpZ25hdHVyZSIsInB1YmxpY0tleSIsInZlcmlmeU1lc3NhZ2VXaXRoUHVibGljS2V5Iiwic2lnbmF0dXJlQnl0ZXMiLCJOQUNMX1NJR05fUFVCTElDS0VZX0xFTkdUSCIsIkVycm9yIiwiTkFDTF9TSUdOX1NJR05BVFVSRV9MRU5HVEgiLCJzaWduRGF0YVdpdGhQcml2YXRlS2V5IiwiZGF0YSIsInByaXZhdGVLZXkiLCJzaWduRGF0YVdpdGhQYXNzcGhyYXNlIiwic2lnbkRhdGEiLCJ2ZXJpZnlEYXRhIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBY0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBbkJBOzs7Ozs7Ozs7Ozs7OztBQTBCQSxJQUFNQSxZQUFZLEdBQUcsU0FBZkEsWUFBZSxDQUFDQyxJQUFEO0FBQUEsd0JBQWtDQSxJQUFsQztBQUFBLENBQXJCOztBQUNBLElBQU1DLG1CQUFtQixHQUFHRixZ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Q0FBUDtBQUNBLENBUE07Ozs7QUFTQSxJQUFNVSxzQkFBc0IsR0FBRyxTQUF6QkEsc0JBQXlCLENBQ3JDRixJQURxQyxFQUVyQ1gsVUFGcUMsRUFHekI7QUFBQSwrQkFDZ0IscURBQzNCQSxVQUQyQixDQURoQjtBQUFBLE1BQ0pDLGVBREksMEJBQ0pBLGVBREk7O0FBS1osU0FBT1Msc0JBQXNCLENBQUNDLElBQUQsRUFBT1YsZUFBUCxDQUE3QjtBQUNBLENBVE07OztBQVdBLElBQU1hLFFBQVEsR0FBR0Qsc0JBQWpCOzs7QUFFQSxJQUFNRSxVQUFVLEdBQUcsU0FBYkEsVUFBYSxDQUN6QkosSUFEeUIsRUFFekJSLFNBRnlCLEVBR3pCQyxTQUh5QjtBQUFBLFNBS3pCLDBCQUFlTyxJQUFmLEVBQXFCLHlCQUFZUixTQUFaLENBQXJCLEVBQTZDLHlCQUFZQyxTQUFaLENBQTdDLENBTHlCO0FBQUEsQ0FBbkIiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQ29weXJpZ2h0IMKpIDIwMTggTGlzayBGb3VuZGF0aW9uXG4gKlxuICogU2VlIHRoZSBMSUNFTlNFIGZpbGUgYXQgdGhlIHRvcC1sZXZlbCBkaXJlY3Rvcnkgb2YgdGhpcyBkaXN0cmlidXRpb25cbiAqIGZvciBsaWNlbnNpbmcgaW5mb3JtYXRpb24uXG4gKlxuICogVW5sZXNzIG90aGVyd2lzZSBhZ3JlZWQgaW4gYSBjdXN0b20gbGljZW5zaW5nIGFncmVlbWVudCB3aXRoIHRoZSBMaXNrIEZvdW5kYXRpb24sXG4gKiBubyBwYXJ0IG9mIHRoaXMgc29mdHdhcmUsIGluY2x1ZGluZyB0aGlzIGZpbGUsIG1heSBiZSBjb3BpZWQsIG1vZGlmaWVkLFxuICogcHJvcGFnYXRlZCwgb3IgZGlzdHJpYnV0ZWQgZXhjZXB0IGFjY29yZGluZyB0byB0aGUgdGVybXMgY29udGFpbmVkIGluIHRoZVxuICogTElDRU5TRSBmaWxlLlxuICpcbiAqIFJlbW92YWwgb3IgbW9kaWZpY2F0aW9uIG9mIHRoaXMgY29weXJpZ2h0IG5vdGljZSBpcyBwcm9oaWJpdGVkLlxuICpcbiAqL1xuaW1wb3J0IHsgZW5jb2RlIGFzIGVuY29kZVZhckludCB9IGZyb20gJ3ZhcnVpbnQtYml0Y29pbic7XG5pbXBvcnQgeyBidWZmZXJUb0hleCwgaGV4VG9CdWZmZXIgfSBmcm9tICcuL2J1ZmZlcic7XG5pbXBvcnQgeyBTSUdORURfTUVTU0FHRV9QUkVGSVggfSBmcm9tICcuL2NvbnN0YW50cyc7XG5pbXBvcnQgeyBoYXNoIH0gZnJvbSAnLi9oYXNoJztcbmltcG9ydCB7IGdldFByaXZhdGVBbmRQdWJsaWNLZXlCeXRlc0Zyb21QYXNzcGhyYXNlIH0gZnJvbSAnLi9rZXlzJztcbmltcG9ydCB7XG5cdE5BQ0xfU0lHTl9QVUJMSUNLRVlfTEVOR1RILFxuXHROQUNMX1NJR05fU0lHTkFUVVJFX0xFTkdUSCxcblx0c2lnbkRldGFjaGVkLFxuXHR2ZXJpZnlEZXRhY2hlZCxcbn0gZnJvbSAnLi9uYWNsJztcblxuY29uc3QgY3JlYXRlSGVhZGVyID0gKHRleHQ6IHN0cmluZyk6IHN0cmluZyA9PiBgLS0tLS0ke3RleHR9LS0tLS1gO1xuY29uc3Qgc2lnbmVkTWVzc2FnZUhlYWRlciA9IGNyZWF0ZUhlYWRlcignQkVHSU4gTElTSyBTSUdORUQgTUVTU0FHRScpO1xuY29uc3QgbWVzc2FnZUhlYWRlciA9IGNyZWF0ZUhlYWRlcignTUVTU0FHRScpO1xuY29uc3QgcHVibGljS2V5SGVhZGVyID0gY3JlYXRlSGVhZGVyKCdQVUJMSUMgS0VZJyk7XG5jb25zdCBzZWNvbmRQdWJsaWNLZXlIZWFkZXIgPSBjcmVhdGVIZWFkZXIoJ1NFQ09ORCBQVUJMSUMgS0VZJyk7XG5jb25zdCBzaWduYXR1cmVIZWFkZXIgPSBjcmVhdGVIZWFkZXIoJ1NJR05BVFVSRScpO1xuY29uc3Qgc2Vjb25kU2lnbmF0dXJlSGVhZGVyID0gY3JlYXRlSGVhZGVyKCdTRUNPTkQgU0lHTkFUVVJFJyk7XG5jb25zdCBzaWduYXR1cmVGb290ZXIgPSBjcmVhdGVIZWFkZXIoJ0VORCBMSVNLIFNJR05FRCBNRVNTQUdFJyk7XG5cbmNvbnN0IFNJR05FRF9NRVNTQUdFX1BSRUZJWF9CWVRFUyA9IEJ1ZmZlci5mcm9tKFNJR05FRF9NRVNTQUdFX1BSRUZJWCwgJ3V0ZjgnKTtcbmNvbnN0IFNJR05FRF9NRVNTQUdFX1BSRUZJWF9MRU5HVEggPSBlbmNvZGVWYXJJbnQoU0lHTkVEX01FU1NBR0VfUFJFRklYLmxlbmd0aCk7XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2lnbmVkTWVzc2FnZVdpdGhPbmVQYXNzcGhyYXNlIHtcblx0cmVhZG9ubHkgbWVzc2FnZTogc3RyaW5nO1xuXHRyZWFkb25seSBwdWJsaWNLZXk6IHN0cmluZztcblx0cmVhZG9ubHkgc2lnbmF0dXJlOiBzdHJpbmc7XG59XG5leHBvcnQgY29uc3QgZGlnZXN0TWVzc2FnZSA9IChtZXNzYWdlOiBzdHJpbmcpOiBCdWZmZXIgPT4ge1xuXHRjb25zdCBtc2dCeXRlcyA9IEJ1ZmZlci5mcm9tKG1lc3NhZ2UsICd1dGY4Jyk7XG5cdGNvbnN0IG1zZ0xlbkJ5dGVzID0gZW5jb2RlVmFySW50KG1lc3NhZ2UubGVuZ3RoKTtcblx0Y29uc3QgZGF0YUJ5dGVzID0gQnVmZmVyLmNvbmNhdChbXG5cdFx0U0lHTkVEX01FU1NBR0VfUFJFRklYX0xFTkdUSCxcblx0XHRTSUdORURfTUVTU0FHRV9QUkVGSVhfQllURVMsXG5cdFx0bXNnTGVuQnl0ZXMsXG5cdFx0bXNnQnl0ZXMsXG5cdF0pO1xuXG5cdHJldHVybiBoYXNoKGhhc2goZGF0YUJ5dGVzKSk7XG59O1xuXG5leHBvcnQgY29uc3Qgc2lnbk1lc3NhZ2VXaXRoUGFzc3BocmFzZSA9IChcblx0bWVzc2FnZTogc3RyaW5nLFxuXHRwYXNzcGhyYXNlOiBzdHJpbmcsXG4pOiBTaWduZWRNZXNzYWdlV2l0aE9uZVBhc3NwaHJhc2UgPT4ge1xuXHRjb25zdCBtc2dCeXRlcyA9IGRpZ2VzdE1lc3NhZ2UobWVzc2FnZSk7XG5cdGNvbnN0IHtcblx0XHRwcml2YXRlS2V5Qnl0ZXMsXG5cdFx0cHVibGljS2V5Qnl0ZXMsXG5cdH0gPSBnZXRQcml2YXRlQW5kUHVibGljS2V5Qnl0ZXNGcm9tUGFzc3BocmFzZShwYXNzcGhyYXNlKTtcblx0Y29uc3Qgc2lnbmF0dXJlID0gc2lnbkRldGFjaGVkKG1zZ0J5dGVzLCBwcml2YXRlS2V5Qnl0ZXMpO1xuXG5cdHJldHVybiB7XG5cdFx0bWVzc2FnZSxcblx0XHRwdWJsaWNLZXk6IGJ1ZmZlclRvSGV4KHB1YmxpY0tleUJ5dGVzKSxcblx0XHRzaWduYXR1cmU6IGJ1ZmZlclRvSGV4KHNpZ25hdHVyZSksXG5cdH07XG59O1xuXG5leHBvcnQgY29uc3QgdmVyaWZ5TWVzc2FnZVdpdGhQdWJsaWNLZXkgPSAoe1xuXHRtZXNzYWdlLFxuXHRwdWJsaWNLZXksXG5cdHNpZ25hdHVyZSxcbn06IFNpZ25lZE1lc3NhZ2VXaXRoT25lUGFzc3BocmFzZSk6IGJvb2xlYW4gPT4ge1xuXHRjb25zdCBtc2dCeXRlcyA9IGRpZ2VzdE1lc3NhZ2UobWVzc2FnZSk7XG5cdGNvbnN0IHNpZ25hdHVyZUJ5dGVzID0gaGV4VG9CdWZmZXIoc2lnbmF0dXJlKTtcblx0Y29uc3QgcHVibGljS2V5Qnl0ZXMgPSBoZXhUb0J1ZmZlcihwdWJsaWNLZXkpO1xuXG5cdGlmIChwdWJsaWNLZXlCeXRlcy5sZW5ndGggIT09IE5BQ0xfU0lHTl9QVUJMSUNLRVlfTEVOR1RIKSB7XG5cdFx0dGhyb3cgbmV3IEVycm9yKFxuXHRcdFx0YEludmFsaWQgcHVibGljS2V5LCBleHBlY3RlZCAke05BQ0xfU0lHTl9QVUJMSUNLRVlfTEVOR1RIfS1ieXRlIHB1YmxpY0tleWAsXG5cdFx0KTtcblx0fVxuXG5cdGlmIChzaWduYXR1cmVCeXRlcy5sZW5ndGggIT09IE5BQ0xfU0lHTl9TSUdOQVRVUkVfTEVOR1RIKSB7XG5cdFx0dGhyb3cgbmV3IEVycm9yKFxuXHRcdFx0YEludmFsaWQgc2lnbmF0dXJlIGxlbmd0aCwgZXhwZWN0ZWQgJHtOQUNMX1NJR05fU0lHTkFUVVJFX0xFTkdUSH0tYnl0ZSBzaWduYXR1cmVgLFxuXHRcdCk7XG5cdH1cblxuXHRyZXR1cm4gdmVyaWZ5RGV0YWNoZWQobXNnQnl0ZXMsIHNpZ25hdHVyZUJ5dGVzLCBwdWJsaWNLZXlCeXRlcyk7XG59O1xuXG5leHBvcnQgY29uc3Qgc2lnbkRhdGFXaXRoUHJpdmF0ZUtleSA9IChcblx0ZGF0YTogQnVmZmVyLFxuXHRwcml2YXRlS2V5OiBCdWZmZXIsXG4pOiBzdHJpbmcgPT4ge1xuXHRjb25zdCBzaWduYXR1cmUgPSBzaWduRGV0YWNoZWQoZGF0YSwgcHJpdmF0ZUtleSk7XG5cblx0cmV0dXJuIGJ1ZmZlclRvSGV4KHNpZ25hdHVyZSk7XG59O1xuXG5leHBvcnQgY29uc3Qgc2lnbkRhdGFXaXRoUGFzc3BocmFzZSA9IChcblx0ZGF0YTogQnVmZmVyLFxuXHRwYXNzcGhyYXNlOiBzdHJpbmcsXG4pOiBzdHJpbmcgPT4ge1xuXHRjb25zdCB7IHByaXZhdGVLZXlCeXRlcyB9ID0gZ2V0UHJpdmF0ZUFuZFB1YmxpY0tleUJ5dGVzRnJvbVBhc3NwaHJhc2UoXG5cdFx0cGFzc3BocmFzZSxcblx0KTtcblxuXHRyZXR1cm4gc2lnbkRhdGFXaXRoUHJpdmF0ZUtleShkYXRhLCBwcml2YXRlS2V5Qnl0ZXMpO1xufTtcblxuZXhwb3J0IGNvbnN0IHNpZ25EYXRhID0gc2lnbkRhdGFXaXRoUGFzc3BocmFzZTtcblxuZXhwb3J0IGNvbnN0IHZlcmlmeURhdGEgPSAoXG5cdGRhdGE6IEJ1ZmZlcixcblx0c2lnbmF0dXJlOiBzdHJpbmcsXG5cdHB1YmxpY0tleTogc3RyaW5nLFxuKTogYm9vbGVhbiA9PlxuXHR2ZXJpZnlEZXRhY2hlZChkYXRhLCBoZXhUb0J1ZmZlcihzaWduYXR1cmUpLCBoZXhUb0J1ZmZlcihwdWJsaWNLZXkpKTtcbiJdfQ==